<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/project.css" rel="stylesheet" />
		<style type="text/css">
			
		</style>
	</head>

	<body>
		<!--侧滑菜单容器-->
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable mui-scalable">
			<!--菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-right">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="title">侧滑导航</div>
						<div class="content">
							这是可拖动式侧滑菜单示例，你可以在这里放置任何内容；关闭侧滑菜单有多种方式： 1.在手机屏幕任意位置向右拖动(drag)；2.点击本侧滑菜单页之外的任意位置; 3.点击如下红色按钮
							<span class="android-only">；4.Android手机按back键；5.Android手机按menu键
							</span>。
							<p style="margin: 10px 15px;">
								<button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;">关闭侧滑菜单</button>
							</p>
	
						</div>
					</div>
				</div>
			</aside>
			
			<div class="mui-inner-wrap">
				<div class="mui-content mui-scroll-wrapper"  id="offCanvasContentScroll" style="background: #FFF;">
					<div class="brand"></div>
					
					<div class="project">
						<span class="project-label">请选择您要继续游戏的<em>城堡</em></span>
						<div class="project-list" id="projects">
							
						</div>
						<button type="button" class="mui-btn mui-btn-sg" id="next">继续游戏</button>
					</div>
					
				</div>
			</div>
		</div>		
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				
				$.init();
				
				$.plusReady(function() {
					var offCanvasWrapper = mui('#offCanvasWrapper');
//					document.getElementById('offCanvasShow').addEventListener('tap', function() {
//						offCanvasWrapper.offCanvas('show');
//					});
					
					var memberId = plus.storage.getItem('member_id');
					
					mui.post(url+'Project/get_project_join_list',{
							member_id: memberId
						},function(data){
							var sOut = '',
								projects = data.data;
							var showCreate = false,
								projectCount = projects.length;
							if (projectCount < 3) {
								projectCount++;
								showCreate = true;
							}
							for (var i = 0; i < projectCount; i++) {
								sOut += '<ul class="mui-table-view">';
								sOut += i == 0 ? '<li class="mui-table-view-cell mui-media on">' : '<li class="mui-table-view-cell mui-media">';
								sOut += '<a href="javascript:;">';
								sOut += '<img class="mui-media-object mui-pull-right project-icon" src="images/logo_bg.png">';
								sOut += '<div class="mui-media-body">';
								sOut += '<div class="icon-item mui-pull-left"><div class="icon-t"></div><div class="icon-b"></div></div>';
								sOut += '<div class="project-item">';
								
								if (showCreate && i == 2) {
									// 显示创建新城堡
									sOut += '<h2 class="mui-ellipsis project-title">创建新城堡</h2>';
								} else {
									sOut += '<h2 class="mui-ellipsis project-title">'+projects[i]['project_name']+'</h2>';
									sOut += '<p class="project-status">城堡运行了<em>'+projects[i]['days']+'</em>天</p>';
								}
								
								sOut += '</div></div></a></li></ul>';
							}
							document.getElementById("projects").innerHTML = sOut;
							
							mui(".mui-table-view").on('tap','.mui-table-view-cell',function(){
								mui('.mui-table-view-cell').each(function(){
									this.classList.remove('on')
								})
							  	this.classList.add('on');
							})
						},'json'
					);
					
					var taskPage = $.preload({
						"id": 'task',
						"url": 'task.html'
					});
					
					// 点击继续游戏
					var nextBtn = doc.getElementById('next');
					nextBtn.addEventListener('tap', function(){
						$.fire(taskPage, 'show', null);
						$.openWindow({
							id: 'task',
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: false
							}
						});
					})
				});
				
			}(mui, document));
		</script>
	</body>

</html>